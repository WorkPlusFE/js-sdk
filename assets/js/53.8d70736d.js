(window.webpackJsonp=window.webpackJsonp||[]).push([[53],{552:function(a,t,s){"use strict";s.r(t);var e=s(37),v=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"离线应用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#离线应用"}},[a._v("#")]),a._v(" 离线应用")]),a._v(" "),s("p",[a._v("离线应用，就是把前端静态资源文件放置到客户端本地，提高访问速度的同时，也节省流量。当前离线应用功能只在移动客户端上提供。")]),a._v(" "),s("h2",{attrs:{id:"压缩包的规范"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#压缩包的规范"}},[a._v("#")]),a._v(" 压缩包的规范")]),a._v(" "),s("p",[a._v("发布离线应用，需要对前端资源包进行压缩，格式规定为"),s("code",[a._v("zip")]),a._v("。除了格式要求，资源的目录也同样有要求，以下面例子为例：")]),a._v(" "),s("p",{staticClass:"w6s-image"},[s("img",{attrs:{src:a.$withBase("/app/offline-files.png"),alt:"离线资源",width:"70%"}})]),a._v(" "),s("p",[a._v("正确的做法是，选中"),s("code",[a._v("mobile")]),a._v("文件夹进行压缩，而不是全选 mobile 内所有文件进行压缩。压缩包生成后，上传即可。")]),a._v(" "),s("h2",{attrs:{id:"启动地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动地址"}},[a._v("#")]),a._v(" 启动地址")]),a._v(" "),s("p",[a._v("压缩包上传成功后，还需要设置应用的启动地址。")]),a._v(" "),s("p",[a._v("当应用上架后被首次打开，客户端会根据应用的设置，把离线资源包下载到本地，并进行解压。所以离线应用在首次打开都会比较慢，因为多了一个下载及解压资源的过程。为了能在解压后，找到对应的应用，客户端制定了一套 URL 规范，根据上一步生成的压缩包，启动地址应该是这样填写：")]),a._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[a._v("local"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mobile"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("html\n")])])]),s("p",[a._v("URL 解析说明：")]),a._v(" "),s("ul",[s("li",[s("code",[a._v("local://")]),a._v(" 特定协议，客户端会以离线应用的方式处理；")]),a._v(" "),s("li",[s("code",[a._v("mobile")]),a._v(" 压缩包解压后的一级目录，如果是多层级的，都可以拼上去；")]),a._v(" "),s("li",[s("code",[a._v("index.html")]),a._v(" 应用的入口文件。")])]),a._v(" "),s("h2",{attrs:{id:"前端-api-地址"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端-api-地址"}},[a._v("#")]),a._v(" 前端 API 地址")]),a._v(" "),s("p",[a._v("因为离线应用是以"),s("code",[a._v("file://")]),a._v("协议打开，如下:")]),a._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[a._v("file"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("offline"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("app"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("app_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("version"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("mobile"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("index"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("html\n")])])]),s("p",[a._v("所以，在离线应用中，Ajax 请求的 api 地址，切勿使用相对路径，请使用"),s("strong",[a._v("全路径")]),a._v("。")]),a._v(" "),s("h2",{attrs:{id:"ios-wkwebview-的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ios-wkwebview-的问题"}},[a._v("#")]),a._v(" iOS WKWebView 的问题")]),a._v(" "),s("p",[a._v("基于"),s("code",[a._v("WKWebView")]),a._v("的安全机制，离线应用以"),s("code",[a._v("file://")]),a._v("协议访问资源，而"),s("code",[a._v("Ajax请求")]),a._v("是走"),s("code",[a._v("http")]),a._v("的，这种情况下，会被认定为跨域。解决跨域的方式有很多，例如后台做"),s("code",[a._v("CORS")]),a._v("处理。")]),a._v(" "),s("p",[a._v("但是这里还存在一个问题，就是"),s("code",[a._v("cookie")]),a._v("。因为 cookie 本身也是有同源的限制，所以在跨域的情况下，cookie 无法被正常传递。所以，我们推荐使用其他的方式进行用户身份认证，例如使用"),s("code",[a._v("jwt(json web token)")]),a._v("。")]),a._v(" "),s("h2",{attrs:{id:"更新机制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新机制"}},[a._v("#")]),a._v(" 更新机制")]),a._v(" "),s("p",[a._v("离线应用的更新，就不会像以"),s("code",[a._v("http")]),a._v("打开的应用方便。")]),a._v(" "),s("p",[a._v("如果需要更新离线应用，需要在管理后台上架新的应用版本，然后上传新的离线资源包。当应用上架后，在客户端首次打开，客户端会检测到应用有更新，就会再次下载并解压离线资源包，完成后，应用将正常打开。")]),a._v(" "),s("blockquote",[s("p",[a._v("上架新版本后，可以在客户端切换底部 tab 来触发同步更新。")])])])}),[],!1,null,null,null);t.default=v.exports}}]);